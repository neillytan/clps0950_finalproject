% -- Combines image rescaling and formatted text -- %
% used http://psychtoolbox.org/docs/DrawFormattedText and http://peterscarfe.com/scaledimagedemo.html for help
% wrapping doesnt work because in docs the 'wrapat' parameter is considered "experimental" and "even then it might work badly"  lolol rip

% Clear the workspace and the screen
sca;
close all;
clearvars;
Screen( 'Preference' , 'SkipSyncTests' , 1 );
PsychDefaultSetup(2);

% Get the screen numbers
screens = Screen('Screens');
screenNumber = max(screens);

% Define black and white
white = WhiteIndex(screenNumber);
black = BlackIndex(screenNumber);
grey = white / 2;

% Open an on screen window
[window, windowRect] = PsychImaging('OpenWindow', screenNumber, grey);

% Text font and style
Screen('TextFont',window, 'Courier New');
Screen('TextSize',window, 16);
Screen('TextStyle', window, 1+2);

% Get the size of the on screen window
[screenXpixels, screenYpixels] = Screen('WindowSize', window);

% Query the frame duration
ifi = Screen('GetFlipInterval', window);

% Get the centre coordinate of the window
[xCenter, yCenter] = RectCenter(windowRect);
image_flowchart = imread('/Users/ntan/Documents/MATLAB/Flowchart.png');

%specify text
mytext = '\n\n Choosing the first digit:\n\n Below are some instructions for choosing the first digits. \n\n 1: If the behavior was unintentional, it is probably a CAUSE EXPLANATION \n\n 2: If the intention of the behavior is explained, but the content of the explanation\n was NOT consciously considered by the agent, it is probably a CAUSAL HISTORY EXPLANATION \n\n 3: If the intention of the behavior is explained, and was a marked desire,\n belief, or valuing of the agent, it is probably a marked REASON EXPLANATION \n\n 4: If the intention of the behavior is explained, and was an unmarked desire, belief,\n or valuing of the agent, it is probably an unmarked REASON EXPLANATION \n\n 6: If the intention of the behavior is not explained, but rather answers the question \n''how is this possible?'' then it is probably an ENABLING FACTOR EXPLANATION \n\n 0: if this is uncodeable press zero \n\n Please press the corresponding key to your decision\n\n';

% Make the image into a texture
imageTexture = Screen('MakeTexture', window, image_flowchart);

% Get the size of the image
[s1, s2, s3] = size(image_flowchart);
aspectRatio = s2 / s1;

% set the height of each drawn image to a fraction of the screens height
heightScalers = linspace(1, 0.2, 10);
imageHeights = screenYpixels .* heightScalers;
imageWidths = imageHeights .* aspectRatio;
dstRects = zeros(4, 1);

theRect = [0 0 imageWidths(1) imageHeights(1)];
dstRects(:, 1) = CenterRectOnPointd(theRect .* 0.4, screenXpixels* 0.8,...
(screenYpixels*0.5+150));

% % Draw image to the screen
DrawFormattedText(window, mytext, 300, (screenYpixels*0.5), 0);
Screen('DrawTextures', window, imageTexture, [], dstRects);
Screen('Flip', window);
KbStrokeWait;
sca;
